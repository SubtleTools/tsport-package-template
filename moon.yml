language: 'typescript'
type: 'library'

tasks:
  build:
    command: 'bun'
    args: ['run', 'build:clean', '&&', 'bun', 'run', 'build:compile']
    inputs:
      - 'src/**/*'
      - 'tsconfig.json'
    outputs:
      - 'dist/**/*'

  build:clean:
    command: 'rm'
    args: ['-rf', 'dist']

  build:compile:
    command: 'bun'
    args: ['tsc']
    deps: ['build:clean']

  dev:
    command: 'bun'
    args: ['run', '--watch', 'src/index.ts']
    local: true

  test:
    command: 'bun'
    args: ['test']
    inputs:
      - 'src/**/*'
      - 'test/**/*'

  test:filter:
    command: 'bun'
    args: ['test', '--filter']
    local: true

  test:compatibility:
    command: 'bun'
    args: ['test', 'automated-cases.test.ts']

  setup:
    command: 'bun'
    args: ['run', 'scripts/setup-reference.ts']
    local: true
    env:
      GO_REPO: '{{ goRepo }}'

  prepublish:
    command: 'bun'
    args: ['run', 'build', '&&', 'bun', 'test']
    deps: ['build', 'test']

  prepack:
    command: 'bun'
    args: ['run', 'build']
    deps: ['build']